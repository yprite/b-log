# Chapter 1. 이더리움이란 무엇인가?
- 블록체인
  - 블록체인이란?
    - images_stella_y_post_208f2785-e14c-4e1c-9027-d126ece808c1_image.png
    - 블록체인은 관리 대상 데이터를 블록이라고 하는 자료구조에 저장하여 체인의 형태를 이룬 것
    - 데이터를 분산데이터 환경에 저장함으로서 누구라도 임의로 수정할 수 없고 누구나 변경의 결과를 열람할 수 있도록 하는 분산컴퓨팅 기반의 원장 관리 기술
  - 분산 원장이란 모든 거래 참여자가 거래 장부를 각각 소유하고 이를 분산하여 갖고 있는 것
  - 제 3자가 포함되지 않은 채 거래 당사자끼리만 통신하는 것을 Peer-To-Peer 또는 P2P 방식이라고 함
  - 모든 거래를 블록과 체인 형태로 저장하고 있기에 블록체인이라고 부르게 됨
  - 블록 체인에서 블록의 의미
    - images_stella_y_post_83280fd3-6511-4dd3-9932-284c73bce17e_image.png
    - 하나의 블록에는 여러 정보들이 저장
    - 블록체인에 참여하는 사람들은 이렇게 여러 정보들이 포함된 블록 덩어리들을 각각 소유
  - 블록 체인의 특징
    - Immutable
      - images_stella_y_post_045ed325-e312-452b-b4a7-985c4e5db385_image.png
      - 그림에서 아랫부분에 있는 레고를 다른 레고로 바꾸고 싶다면 어떻게 할 수 있을까?
      - 블록을 교체하려면 초록색 블록 위에 쌓인 모든 블록을 제거하고, 해당 블록을 원하는 블록으로 바꾼다음, 새롭게 블록을 쌓아야함
      - 레고에서의 중간 블록을 다른 블록으로 대체하기 어려운 이유와 블록체인의 위조가 어려운 이유는 동일
      - 블록체인 내에 연결되어 있는 중간 블록 하나 만을 다른 블록으로 바꾸는 것은 불가능하기 때문에 이후에 있는 블록을 모두 바꿔주어야 함
      - 따라서 블록체인을 위조하거나 수정하는 것이 거의 불가능
    - Decentralized
      - 블록체인 시스템에서는 중앙 기관이 불필요
      - 은행을 중심으로 돈을 이체할 경우 사람간의 돈을 이체했다는 정보를 관리하는 은행이라는 중앙기관을 이용
      - 블록체인의 경우 돈을 보냈다는 정보를 개인이 모두 가지고 있기 때문에 은행이라는 중개 기관을 거치지 않고 개인과 개인 간에 금융 거래를 할 수 있음
      - 이 금융거래의 내용이 블록체인에 기록이 되기 때문
  - 블록체인 메커니즘
    - 어떤 유저가 트랜잭션을 요청하게 되면 해당 데이터는 블록에 저장
    - 해당 블록은 네트워크에 있는 다른 유저들에게 전달되게 되고 각 유저들은 거래의 타당성을 확인
    - 거래에 이상이 없다면 새로운 블록 데이터가 생성되고 그 블록은 기존의 블록체인에 연결
  - 예시로 확인
    - images_stella_y_post_9e781cff-dbb4-4ad5-b712-d208ecc82c14_image.png
    - 앨리스와 밥을 포함한 1000명의 참여자가 있는 블록체인 네트워크를 생각해보자. 앨리스가 밥에게 두 개의 동전을 빌려주는 경우, 해당 거래는 모든 참여자에게 전송된다. 즉 모든 참여자들이, 앨리스가 밥에게 2개의 동전을 빌려주었다는 사실을 노트에 기록하게 된다.
    - 앨리스는 밥으로부터 받아야 할 2개의 동전보다 더 많은 동전을 받으려는 욕심에, 밥과 자신의 노트를 의도적으로 조작하려 한다면 어떻게 될까? 앨리스는 노트에 자신이 밥에게 2개의 동전을 빌려주었다는 사실을 지우고, 5개의 동전을 빌려주었다고 거짓으로 노트를 수정할 것이다. 하지만 나머지 998명의 학생들의 노트에는 앨리스가 밥에게 오직 2개의 동전을 빌려주었다는 사실이 기록되어 있다. 따라서 다른 학생들에 의해 앨리스가 의도적으로 거래를 조작했다는 사실을 확인할 수 있게 된다.
    - 만약 앨리스가 5개의 코인을 회수하려고 한다면, 학생들 중 50% 이상이 앨리스가 밥에게 5개의 동전을 빌려줬다는 것에 동의해야만 한다. 즉, 51%에 해당하는 최소한 501개의 학생 노트가 악의적인 조작을 위해 수정되어야 함을 의미한다. 하지만 501개의 노트를 앨리스가 수정하는 것은 쉽지 않은 일이다.
    - 이렇게, 블록체인 네트워크에서는 한 참여자가 의도적으로 데이터를 조작하려고 하더라도, 다른 참여자들이 동일한 데이터를 유지하고 있기 때문에 조작과 위조가 어려워진다.
    - 게임이론 (https://academy.binance.com/ko/articles/game-theory-and-cryptocurrencies)
- 비트코인
  - #아나키즘, #반정부주의, #민주주의, #게임이론, #탈중앙화, #금융위기, #사토시
  - 비트코인 거래과정
    - images_stella_y_post_a3a497db-96ed-400b-abd9-7fd5050a2984_image.png
    - 비트코인에서는 계좌의 개념 대신 월렛 주소라는 개념이 등장
    - 각 유저는 비트코인을 저장하기 위해 하나 이상의 주소를 가질 수 있음
    - A가 B에게 3비트코인을 보내려고 한다면, A는 B에게 비트코인 주소를 요청하고, 해당 비트코인 주소로 3비트코인을 전송
    - A가 B에게 3비트코인을 보냈다는 기록이 블록체인 내에 기록되면, 비트코인 전송이 완료
  - 비트코인 채굴
    - images_stella_y_post_74f7b287-4f1e-4d9e-aae3-a0bd9136219a_image.png
    - 비트코인에서 채굴은 두가지 의미
      - 블록체인에 추가할 새로운 블록을 생성하는 것
      - 비트코인이라는 암호화폐를 생성하는 것
    - 즉, 비트코인 네트워크에서는 일련의 과정을 거쳐 기존의 블록체인에 추가할 블록을 생성하게 되고, 블록 생성의 결과로 새로운 비트코인이 생성
    - 이렇게 새로운 블록과 비트코인을 생성하는 과정을 채굴(Mining)이라고 말함
  - 채굴 과정
    - images_stella_y_post_46f5364a-5a51-4057-a945-96ac700955a9_image.png
    - 비트코인을 채굴하는 과정은 일종의 퍼즐 풀기와 같음
    - 시간과 컴퓨팅 파워를 소모해서 퍼즐을 풀 수 있는 값을 찾음
    - 퍼즐을 풀 수 있는 퍼즐 조각을 찾으면 비로소 새로운 블록을 생성할 수 있게 되고, 새롭게 생성된 블록은 기존의 블록체인에 연결
    - 퍼즐의 난이도를 의미하는 특정 목표 값이 있고, 0부터 1씩 점차적으로 증가하는 nonce라고 하는 값이 있음
    - 이 nonce값은 hash함수를 통해 임의 값 = 퍼즐
    - 목표값보다 작은 값을 가질때까지 퍼즐 조각을 생성
    - 같은 과정을 반복하다가 목표값보다 작은 값을 가지는 퍼즐 조각을 발견한다면, 퍼즐을 완성
    - 비로소 블록을 생성할 수 있는 권한을 가지게 됨
    - 퍼즐의 난이도는 퍼즐을 완성하는 시간이 10분 정도가 소요되게끔 시스템에 정해져 있음
    - 하나의 퍼즐을 풀어 블록을 생성하고 나면, 새로운 블록을 생성하기까지 다시 10분이 소요
  - 채굴 보상
    - 채굴을 위한 퍼즐을 풀기 위해서, 채굴자들은 시간과 비용을 소모
    - 아무런 댓가 없이는 아무도 채굴을 하려하지 않게 될 것
    - 두 가지 형태의 보상이 존재
      1. 새로운 블록에서 새 코인을 생성해서 얻는 보상
        - 블럭 생성자에게 직접 코인을 준다
        - 비트코인 총 발행량이 2100만개로 정해져있어 채굴이 계속됨에 따라 채굴 보상이 줄어듬
      2. 이체 수수료
        - 보상 1만 주어진다면 모든 비트코인이 발행되고 나서는 아무도 블록을 채굴하지 않으려하지 않을 것이기 때문에, 이것 외에 이체 수수료라는 두 번째 보상이 존재
        - images_stella_y_post_bffb544e-52c9-4044-a38e-64347587167c_image.png
        - A와 B가 총 10BTC를 소유하고 있고 A가 B에게 3BTC를 보내려는 상황을 가정
          - 일반적으로 거래가 완료된 후, A에게 7 BTC, B에게 13 BTC가 남을 것이라고 예상하겠찌만 실제 비트코인 시스템에서는 그렇지 않음
          - 비트코인은 계좌, 잔액의 개념이 없고 비트코인이 하나의 "덩어리"로 존재
          - 즉 A와 B는 10 BTC에 해당하는 하나의 덩어리를 가지게 되는 것
          - A는 10BTC만큼의 덩어리 하나를 소비해서, B에게 3 BTC를 전송하게 되는 것이고 거래 결과 B는 10 BTC 덩어리 하나와 3BTC 크기의 덩이리 하나를 갖게 되는 것
          - images_stella_y_post_6c4479fe-2a54-4134-93ea-8c6b86693020_image.png
          - 그렇다면 A가 B에게 3BTC를 보낸 후 남은 7BTC는 어디로 갔을까?
          - 비트코인은 잔액의 개념이 없기 때문에, 10BTC 덩어리를 이용해 B에게 3 BTC를 보내고 난 후 남은 7BTC이 자동으로 A에게 남겨지지 않음
          - 보내고 남은 잔액을 돌려받기 위해선 자신이 돌려받을 남은 BTC를 자기 자신에게 다시 보내주어야 함
          - 즉, 3 BTC는 B에게 7BTC는 자기 자신에게 전송해야 하는 방식
          - images_stella_y_post_97869365-ad16-4744-9a23-a391f28d3345_image.png
          - 그런데 이때에 남은 7BTC중 일부를 이체 수수료에 사용할 수 있게 됨
          - 이체 수수료가 블록을 채굴한 채굴자에게 전달되는 두 번째 보상
          - 비트코인 송신자는 비트코인을 전송할 때, 얼마를 상대에게 보내고, 얼마를 자신이 되돌려 받을지를 명시해줌으로써 얼마의 이체수수료를 지불할지를 결정할 수 있게 됨
          - 이렇게 보면, 어떤 바보가 수수료를 내는건지, 남은 금액을 다 자신에게 전송하면되는게 아닌지 의아하겠지만, 비트코인의 거래는 새로운 블럭에 그 거래사항을 기록함으로써 이루어짐
          - 즉 블록에 기입하지 못한 거래는 거래로 인정될 수 없음 (위 예시 참고 51%이상이 찬성)
          - 보통 이체수수료가 높을수록 채굴자가 받는 보상이 높기 때문에, 채굴자들은 이체 수수료가 높은 거래를 선택해 블록 생성을 시도하려는 경우가 많음
          - 이체수수료가 많을 수록 자신이 생성한 거래가 블록체인에 더 빨지 저장될 수 있게 되는 것
  - 비트코인의 한계
    - 낮은 실시간성
      - 채굴 과정의 퍼즐 난이도가 10분정도로 정해져 있기 때문에, 블록 생성의 주기는 10분이상이 될 수 밖에 없음
      - 발생한 거래는 블록에 포함되어, 블록체인에 연결되어야 완료
      - 거래가 완료되기까지 최소 10분을 대기해야한다는 큰 단점
      - 이체 수수료에 따라 더 길어질 수 있기 때문에 거래의 완료를 바로 확인할 수 없다는 단점
      - 실제로 이체수수료를 아주 낮게 설정한다면 최악의 경우 몇일이 걸리 수도 있거나 블록에 포함되지 않을 수도 있음
      - 비트코인의 초당 거래량은 초당 약 7개 정도로 매우 적음
      - VISA신용카드의 초당 거래량이 4천개 정도인 것과 비교하면 매우 느림
    - 에너지 소모
      - 채굴과정에서 퍼즐을 푸는 과정은 에너지 소모량이 매우 많음
      - 블록 채굴을 위해 소모되는 전력량이 아르헨티나의 전력 소모량과 비슷하다는 사례가 있었음
- 이더리움 : 스마트 컨트랙트라는 프로그램을 실행하는 오픈 소스에 기반을 둔, 전 세계에 걸쳐 탈중앙화된 Computing Infrastructure
- 비트코인 vs 이더리움  
  비트코인은 제한된 스크립트 언어를 사용, 그러나 이더리움은 임의성과 무한 복잡성을 가진 코드를 실행할 수 있는 가상 머신을 운영하는
  범용프로그램이 가능한 블록체인으로 설계됨
  - 차이점 1 - Smart Contract
    - 이더리움의 개발자 비탈릭 부테린은 거래 내역을 저장하는 회계장부 형식의 비트코인보다 블록에 더 많은, 더 다양한 내용을 저장하길 원함
    - 거래내역 뿐 아닌 원하는 모든 내용, 정확히는 프로그래밍 코드를 삽입할 수 있는 형태를 구상
    - 이더리움은 프로그래밍 한대로 동작하는 Smart Contract를 실행시키는 분산 컴퓨팅 플랫폼으로 탄생
    - 1세대 블록체인인 비트코인에서는 없었던 smart contract라는 기능을 통해 분산 Application을 제작 할 수 있는 이더리움과 같은 코인들을 2세대 블록체인이라고 부르며, 이후 많은 블록체인 프로젝트들이 이더리움을 모티브로 개발
    - ![Alt text](images_stella_y_post_905e8934-66f5-4770-a7f3-34471b0dda6d_image.png)
    - 비트코인은 금융에 특화되어 화폐 기능을 하는데 초점을 맞추고 있는 플랫폼
    - 비트코인에 저장되는 정보는 참가자들이 만들어내는 거래에는 BTC를 보내고 받는 내용 뿐
    - 이더리움에는 블록체인에 암호화폐인 이더뿐만 아니라 Smart Contract도 저장될 수 있음
    - 오른쪽 그림을 보면 참가자들이 만들어내는 거래에 암호화폐인 이더뿐만 아니라 Smart Contract와 Smart Contract을 이용하기 위한 데이터 등 다양항 정보들이 포함되어 전달
    - 이더리움은 블록에 데이터 뿐만 아니라 smart contract에서 조건문, 반복문 등의 실행코들 포함시켜 저장할 수 있음
      - 거래중, 입금확인, 거래완료 등등의 상태로 더 세분화하여 정보를 저장 (비트코인 경우 사용 or 사용안함의 두가지 상태로만 표현)
  - 차이점 2 - 계정 기반 설계
    - images_stella_y_post_37a9f009-6577-4e0d-ad17-a60c9c281afb_image.png
    - 비트코인은 계정기반으로 설계되어있지 않기 때문에, 사용자는 비트코인 주소만 가지고 있고, 사용자에 대한 어떤 정보도 블록체인에 저장되지 않음
    - 비트코인 지갑에서 보여주는 잔액은, 사용자가 사용할 수 있는 덩어리들을 모두 합하여 보여주는 것일 뿐, 실제의 비트코인은 사용자와 관계없이 덩어리로 존재
    - 이더리움은 계정기반으로 설계되어 있고, 그 계정과 관련된 정보들 또한 블록체인에 저장
    - 실제 해당 계정이 얼만큼 이더를 가지고 있는지도 저장되는 것
    - 누군가에게 이체거래를 할 때, 비트코인에서처럼 덩어리를 쪼개서 보내는 것이 아닌, 이더리움 계정안에 있는 잔액 상태를 직접 변경하며 보내게 되는 것
  - 이 외의 차이점
    - images_stella_y_post_a93335f8-3313-4d74-b4b6-30f6b1f48e33_image.png
    - 블럭 생성 시간과 transaction 처리 시간이 이더리움이 더 빠름
    - 비트코인은 2100만개 코인만이 생성되도록 제한해두어, 발행량을 4년 주기로 반감
    - 이더리움은 아직 구체적인 발행량이 정해지지 않음
    - 채굴 보상의 경우 비트코인은 최초 50btc를 시작으로 4년 주기의 반감기를 가지며 채굴보상이 반감되고 있음
    - 이더리움의 경우 처음에 5eth가 주어지다가 2019년부터는 2eth를 주고 있음
- 이더리움 구성요소
  - P2P Network : 이더리움은 이더리움 메인 네트워크에서 실행됨
  - 합의 규칙 : 이더리움의 합의 규칙은 Yellow Paper(https://pow-project.tistory.com/45)에 정의되어 있음 ( https://ethereum.github.io/yellowpaper/paper.pdf )
  - Transaction : 이더리움 Transaction은 보낸 사람, 받는 사람, 값, 데이터 페이로드가 포함된 네트워크 메시지
  - 상태 머신 : 이더리움 상태 전이는 바이트코드를 실행하는 스택 기반 가상머신인 EVM에 의해 처리, 
               Smart Contract도 EVM 프로그램 중 하나
  - 데이터 구조 : 이더리움의 트랜잭션 및 시스템 상태는 머클 패트리샤 트리라고 하는 Seralize된 Hash data structure이고, 각 노드의 데이터베이스에 저장
  - 합의 알고리즘
    - 나카모토 합의를 사용함. 그러나 지분증명(POS) 가중투표 시스템인 캐스퍼로 전환할 계획
    - 나카모토 합의 : 순차 단일 서명 블록을 사용해 작업증명(POW)의 중요도 가중치간 긴 체인을 결정
  - 경제적 보안성
    - Ethash라는 작업증명(POW)알고리즘을 사용하는 반면, 나중에는 자분증명(POS) 알고리즘을 사용할 예정
  - 클라이언트
    - 이더리움은 클라이언트 소프트웨어를 상호운용할 수 있는 몇 가지 구현체를 갖고 있음
      - 게스(Go-Ehtereum, geth)와 패리티(Parity)
  - 튜링완전
    - 튜링 머신을 시뮬레이션 하는데 사용할 수 있다면 그 시스템은 튜링 완전함
    - 튜링완전한 시스템을 UTM(Universal turing machine)이라고 함
    - 튜링완전은 정지문제를 갖고 있음
    - 정지문제: 무한 루프나 복잡한 프로그램 때문에 과부하가 일어나 정지될 수 있음
    - 이더리움에서는 정지문제를 막기 위해 gas를 도입
  - DAPP: 댑 또는 디앱이라고도 하며, 스마트 컨트랙트와 웹 사용자 인터페이스를 합한 것. 즉 공개되고 탈중앙화된 Peer-To-Peer 기반 서비스위에 제공되는 웹 
